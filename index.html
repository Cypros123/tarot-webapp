<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>–í—ã–±–æ—Ä –∫–∞—Ä—Ç</title>
<style>
  :root { --card-w: 112px; --card-h: 176px; }
  * { box-sizing: border-box; }
  body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial; background:#0b0b15; color:#eee; height:100vh; display:flex; align-items:center; justify-content:center; }
  .wrap { width:100%; max-width:440px; padding:16px; }
  h1 { font-size:18px; text-align:center; margin:0 0 10px; }
  .table { position:relative; width:100%; height: calc(var(--card-h) * 2 + 26px + 40px); }
  .row { display:flex; justify-content:center; gap:12px; margin-bottom:13px; }
  .row:last-child { margin-bottom:0; }
  .card {
    width:var(--card-w); height:var(--card-h);
    border-radius:10px; background:#cdb; position:relative;
    transform-style:preserve-3d; cursor:pointer; transition: transform 0.6s ease;
    box-shadow: 0 8px 24px rgba(0,0,0,.4);
  }
  .card.flipped { transform: rotateY(180deg); }
  .face, .back {
    position:absolute; inset:0; backface-visibility:hidden; border-radius:10px;
    display:flex; align-items:center; justify-content:center; font-weight:600;
  }
  .back { background:#e7dfc7; transform: rotateY(180deg); padding:8px; text-align:center; }
  .face { background:#1b1b28; color:#ffe28a; }
  .glow { box-shadow:0 0 0 rgba(255,255,255,0); }
  .card.selected .glow { animation:halo 1.4s ease infinite; }
  @keyframes halo { 0%{box-shadow:0 0 0 rgba(255,255,255,0);} 50%{box-shadow:0 0 24px rgba(255,255,255,.35);} 100%{box-shadow:0 0 0 rgba(255,255,255,0);} }

  .bottom { position:fixed; left:0; right:0; bottom:16px; display:flex; justify-content:center; }
  .btn {
    min-width:220px; padding:14px 18px; border-radius:14px; font-weight:700; border:none;
    background:linear-gradient(135deg,#4b75ff,#9e74ff); color:#fff; font-size:16px;
    box-shadow: 0 10px 30px rgba(100,80,255,.4); transform: translateY(120px);
    transition: transform .6s ease, opacity .6s ease; opacity:0;
  }
  .btn.show { transform: translateY(0); opacity:1; }
</style>
</head>
<body>
<div class="wrap">
  <h1>–í—ã–±–µ—Ä–∏—Ç–µ 3 –∫–∞—Ä—Ç—ã</h1>
  <div id="table" class="table">
    <div class="row" id="r1"></div>
    <div class="row" id="r2"></div>
  </div>
</div>
<div class="bottom"><button id="go" class="btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button></div>

<script>
  // Mini deck (–ø—Ä–∏–º–µ—Ä–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –¥–ª—è –¥–µ–º–æ)
  const faces = [
    "–î–µ—Å—è—Ç–∫–∞ –∫—É–±–∫–æ–≤","–í–ª—é–±–ª—ë–Ω–Ω—ã–µ","–î–≤–æ–π–∫–∞ –∫—É–±–∫–æ–≤","–¢—É–∑ –º–µ—á–µ–π","–°–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ—Å—Ç—å","–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞","–ö–æ–ª–µ—Å–Ω–∏—Ü–∞"
  ];

  const r1 = document.getElementById('r1'); // top 3
  const r2 = document.getElementById('r2'); // bottom 4
  const go = document.getElementById('go');

  // Build 3 + 4
  function cardEl(i){
    const d = document.createElement('div');
    d.className = 'card'; d.dataset.idx = i;
    d.innerHTML = '<div class="face"><span>üúÅ</span></div><div class="back"><div class="glow"></div><span>'+faces[i]+'</span></div>';
    d.addEventListener('click', onFlip, {once:false});
    return d;
  }
  [0,1,2].forEach(i=>r1.appendChild(cardEl(i)));
  [3,4,5,6].forEach(i=>r2.appendChild(cardEl(i)));

  let picks = [];
  let animating=false;

  function onFlip(e){
    if(animating) return;
    const c = e.currentTarget;
    if(c.classList.contains('flipped')) return;
    if(picks.length>=3) return;
    c.classList.add('flipped','selected');
    picks.push(c.querySelector('.back span').innerText);
    if(picks.length===3){
      // wait flip end of the last card, then move
      animating = true;
      setTimeout(()=> moveToCenter(), 650);
    }
  }

  function moveToCenter(){
    const sel = Array.from(document.querySelectorAll('.card.selected'));
    const tbl = document.getElementById('table').getBoundingClientRect();

    // target line center positions (center of table)
    const gap=12, W=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--card-w')), H=parseInt(getComputedStyle(document.documentElement).getPropertyValue('--card-h'));
    const totalW = W*3 + gap*2;
    const left0 = (tbl.width - totalW)/2;

    sel.forEach((el, idx)=>{
      const r = el.getBoundingClientRect();
      const curX = r.left - tbl.left;
      const curY = r.top - tbl.top;
      const targetX = left0 + idx*(W+gap);
      const targetY = (tbl.height - H)/2;

      const dx = targetX - curX;
      const dy = targetY - curY;
      el.style.transition = 'transform 700ms ease';
      el.style.transform += ` translate(${dx}px, ${dy}px)`;
    });

    setTimeout(()=>{
      animating=false;
      go.classList.add('show');
      go.scrollIntoView({behavior:'smooth', block:'end'});
    }, 750);
  }

  go.addEventListener('click', ()=>{
    const data = { cards: picks.join(', ') };
    if (window.Telegram && Telegram.WebApp) {
      Telegram.WebApp.sendData(JSON.stringify(data));
      Telegram.WebApp.close();
    } else {
      alert(JSON.stringify(data));
    }
  });

  // Telegram theme init if present
  if (window.Telegram && Telegram.WebApp) {
    Telegram.WebApp.expand();
    Telegram.WebApp.ready();
  }
</script>
</body>
</html>
